<script>
  $(function(){
    google.script.run
      .withSuccessHandler(id => $('#user-mail').text(id))
      .getUserId()
    
    google.script.run
      .withSuccessHandler(subjectList => insertOptionDom('subject-select', subjectList))
      .getSubjectList()

    google.script.run
      .withSuccessHandler(classList => insertOptionDom('homeroom-select', classList))
      .getHomeroomList()
  })

  $('#subject-select').change(function(){
    const subject = $(this).val();
    google.script.run
      .withSuccessHandler(teacherList => {
        console.log(teacherList);
        const subjectTeacherList = teacherList.filter(obj => obj.subject === subject);
        const subjectTeacherNameList = subjectTeacherList.map(obj => obj.name);
        console.log(subjectTeacherNameList);
        insertOptionDom('teacher-select', subjectTeacherNameList);
      })
      .getTeacherList()
  });

  function insertOptionDom (targetId, dataList) {
    $(`#${targetId}`).append(
      dataList.map(data => `<option>${data}</option>`)
    )
  }

  $('#button-submit').on('click', function(){
    console.log('test code')
    const obj = {
      mail : $('#user-mail').text(),
      subject : $('#subject-select').val(),
      teacher : $('#teacher-select').val(),
      homeroom : $('#homeroom-select').val(),
      good : $('#comment-good').val(),
      improved : $('#comment-improved').val(),
    }
    google.script.run
      .withSuccessHandler(console.log('success'))
      .withFailureHandler(e => console.log(e))
      .insertToSpreadSheet(obj)
    return false;
  })
</script>